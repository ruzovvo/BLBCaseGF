<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <f:event listener="#{redirectBean.loggedInRedirect()}" type="preRenderView" />

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>Buy</title>
        <link href="css/bootstrap.css" rel="stylesheet"/>
        <link href="css/custom.css" rel="stylesheet"/>

        <!-- Custom styles for this template -->
        <link href="css/jumbotron-narrow.css" rel="stylesheet"/>
        <script type="text/javascript" charset="utf-8" src="js/jquery.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/bootstrap.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/custom.js"></script>

    </h:head>

    <h:body>

        <div class="container-narrow" style="max-width: 820px; padding: 0px 10px; border-left: 1px solid #b9b9b9; background-color: white; border-right: 1px solid #b9b9b9;">
            <div class="header">
                <ul class="nav nav-pills pull-right" style="margin-top: 25px;">
                    <li class="welcome"> <a href="#"  > Welcome Trader <b>#{traderBean.trader.login} </b> </a> </li>
                    <li><a href="javascript: void()" onclick="logout();">Log Out</a></li>
                </ul>
                <span style="display: inline-block; margin-top: 22px; padding: 10px 0px; ">Client:<b>#{clientBean.client.login} (#{clientBean.client.id})</b> | balance: <b>#{clientBean.client.balance}</b> | <a href="index.xhtml"> Change Client</a></span>
            </div>
            <div class="tabbable"> <!-- Only required for left/right tabs -->
                <ul class="nav nav-tabs">
                    <li><a href="javascript: void();" onclick="window.location.href = 'client.xhtml?clientId=' + gup('clientId')"  >Portfolio</a></li>
                    <li class="active" ><a href="javascript: void();" >Buy</a></li>
                    <li><a href="javascript: void();" ><span style="color: lightgray;">Sell</span></a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab1">
                        <table class="table" id="bondsTable">

                        </table>
                        123
                    </div>

                </div>
            </div>



            <div class="footer">
                <p style="margin-bottom: 0px;">OLOLO, 2013</p>
                <div style="display: block; height: 10px;"></div>
            </div>


        </div> <!-- /container -->




        <script>
            //<![CDATA[
           
            function gup( name ){
                name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");  
                var regexS = "[\\?&]"+name+"=([^&#]*)";  
                var regex = new RegExp( regexS );  
                var results = regex.exec( window.location.href ); 
                if( results == null )    return "";  
                else    return results[1];
            }
            
            function generateTableRow(b){
                if (b == undefined){
                    return "";
                }
                return ' <tr> <td><button class="buyButton" data-id="' + b.id +'" > BUY</button></td><td>' + b.CUSIP + '</td><td>' + b.price + '</td><td>' + b.parValue + '</td><td>' + b.coupon +'</td><td>' + b.currentYield +'</td><td>' + b.yieldToMaturity +'</td><td>' + b.rating +'</td><td>' + b.quantity +'</td><td>' + b.value +'</td></tr> ';
            }
            
            function generateTable(array){
                if (array == undefined){
                    return undefined;
                }
                s = ' <tr><th>Select To Buy</th><th>CUSIP</th><th>PRICE</th><th>Par Value</th><th>Coupon</th><th>Current Yield</th><th>Yield To Maturity</th><th>Rating</th><th>Quantity</th><th>Value</th></tr> ';
                for (var i in array){
                    s+=generateTableRow(array[i]);
                }
                return s;
            }
            
            function loadFreeBonds(){
                $.ajax({
                    url: "/BLBWeb/resources/admin/getFreeBonds",
                    success: function(data){
                        de = data.data;
                        if (de != undefined){
                            $('#resultBlock').show();
                        }
                        $('#bondsTable').html(generateTable(data.data));
                        
                        $('.buyButton').bind('click', function(){
                            window.location.href = "buybond.xhtml?clientId="+gup("clientId")+"&bondId="+$(this).attr("data-id");
                        });
                    }
                });
            }
            
                                  
            $(function(){
                loadFreeBonds();
               //window.location.href = window.location.href;
            });
            
            //]]>
        </script>


    </h:body>
</html>